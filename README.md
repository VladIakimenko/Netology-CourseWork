# Общие характеристики приложения

Приложение предназначено для работы с сервисами [vk.com](http://vk.com) и 
[Яндекс Диск](https://disk.yandex.ru). 
Оно позволяет пользоваться некоторыми функциями сервисов (полный перечень представлен в разделе 
[Возможности приложения](#возможности-приложения)) без использования веб-приложений. 

При первом запуске программы происходит создание [токена](#создание-json-токена), который 
в дальнейшем используется для аутентификации пользователя на обоих ресурсах 
одновременно, открывая возможности для прямого обмена данными пользователя между ними.

Приложение также работает с жёстким диском пользователя, позволяя сохранять и загружать
данные с локальной машины.

В процессе работы сохраняется [json лог](#сохранение-лога-действий), регистрирующий все операции произведённые при 
помощи приложения.


# Технические требования и состав программы
Для работы приложения обязательно наличие учётных записей [vk.com](http://vk.com) и 
[Яндекс Диск](https://disk.yandex.ru) и интернет соединения.

В пакете представлены как сырые .py файлы, так и скомпилированный .exe для работы в
системах без установленного интерпретатора Python.

### Работа с .py файлами
Для работы с файлами формата .py потребуется установленный интерпретатор [Python](https://www.python.org/downloads/)
версии не ниже 3.6. Модули, не вошедшие в стартовый пакет Python, но необходимые для работы программы
перечислены в файле **requirements.txt**.

Основным модулем программы является файл **main.py**. Допускается самостоятельное использование
файла **create_TOKEN.py** для пересоздания уже созданного токена, например, для входа в другие аккаунты
vk.com и ЯДиск (тот же эффект может быть достигнут при помощи удаления токена).

Модули **VKLoader.py** и **YaDisk.py** являются самостоятельными классами. В каждом из методов подробно описаны 
докстринги, и классы можно использовать самостоятельно в любом приложении со схожим функционалом.

**Папка data** является неотъемлемой частью программы и должна располагаться в том же каталоге, что .py файлы.

### Работа с .exe

Без установленного интерпретатора программа имеет единственную точку входа: файл **main.exe**. Для корректной работы 
исполняемого файла необходимо наличие папки **build**, папки **data** и файла **main.spec**.

# Возможности приложения
*cписок команд доступен из интерфейса программы при помощи команды "help"*
- [vk show](#получение-списка-альбомов-vkcom)
- [ya show](#получение-списка-файлов-яндекс-диска)
- [vk save](#сохранение-фотографий-c-vkcom)
- [vk post](#публикация-фотографий-на-vkcom)
- [ya upload](#копирование-файлов-с-жёсткого-диска-на-яндекс-диск)
- [ya download](#копирование-файлов-с-яндекс-диска-на-компьютер-пользователя)


### Получение списка альбомов vk.com
Команда: **vk show**

Для каждого из созданных пользователем альбомов приложение выведет:
- Название альбома
- Количество фотографий
- Дата создания
- Количество лайков

Для системных альбомов таких как "сохранённые фотографии", "Фотографии с моей страницы" и "Фотографии на моей стене"
программа выведет пометку "системный" вместо даты создания.

### Получение списка файлов Яндекс Диска
Команда: **ya show**

Программа выведет полный список файлов, хранящихся в облачном хранилище, отсортированный по каталогам, в которых
они хранятся. Также программа выводит сведения о типе файлов и их размере в mb.

ВАЖНО: программа выводит список файлов, рассматривая их расположение как параметр самого файла, поэтому пустые
каталоги отображаться не будут.

### Сохранение фотографий c vk.com
Команда: **vk save**  
Параметр 1: _local_, _yandex_  
Параметр 2: _альбомы, которые требуется сохранить_

Команду можно указывать как с параметрами, так и без. В случае неуказания одного или обоих параметров возникнет
дополнительный диалог, для уточнения недостающей информации. Параметры можно указывать в произвольном порядке.
Параметр 1 не обязательно вводить целиком. Достаточно только первой (или первых) букв слова: _"y", "l", "ya", "loc"_
и т.д.

#### параметр 1
- **local**: сохранение фотографий на жёстком диске

В этом случае пользователю будет предложено выбрать существующий каталог на жёстком диске, куда будут
сохранены фотографии.

- **yandex**: сохранение фотографий на Яндекс Диске

Пользователю потребуется указать каталог на Яндекс Диске. Если указанный каталог не существует, он будет автоматически
создан (вместе со всеми подкаталогами, указанными в пути к файлу)

#### параметр 2
Если параметр 2 не указан, пользователь увидит весь список альбомов, включая системные, пронумерованные сплошной
нумерацией. Для выбора необходимо выбрать один или несколько альбомов (вводится их порядковый номер через запятую) или 
указать * для выбора всех альбомов. Если номера альбомов, уже известны пользователю, их можно указать сразу в команде в 
качестве параметра 2 и избежать появления диалога выбора альбомов.

ВАЖНО: Программа сохраняет фотографии в максимальном из возможных размеров. В качестве имени файла используется
уникальный порядковый номер фотографии и (в скобках) количество лайков у этой фотографии.

### Публикация фотографий на vk.com
Команда: **vk post**  
Параметр 1: _local_, _yandex_  

Команду можно указывать как с параметром, так и без.
Параметр 1 не обязательно вводить целиком. Достаточно только первой (или первых) букв слова: _"y", "l", "ya", "loc"_
и т.д.

#### параметр 1
- **local**: сохранение фотографий c жёстком диска
- **yandex**: сохранение фотографий с Яндекс Диска

В обоих случаях пользователю будет предложено добавить фотографии в список. Файлы можно добавлять по одному или 
указывая каталог целиком. После каждго ввода список файлов обновится и будет выведен на экран, и поле ввода будет готово
для ввода нового файла или папки. 

Допустимо указывать как абсолютный путь к файлу или папке, так и относительный (со стартовой точкой в каталоге, 
где располагается файл main.py(.exe)). Допускается использование как прямого так и обратного слэша. Если нажать "ввод" 
без указания каталога, команда будет расценена как указание текущего каталога (каталог c main.py(.exe)). Имена файлов 
необходимо указывать с учетом регистра и с указанием расширения файла.

При указании каталога на жёстком диске в список попадут только файлы допустимых форматов ("jpg", "png", "gif").  
При публикации фотографий с Яндекс Диска пользователю будут выведены на экран только файлы соответсвующих форматов и их
каталоги. При выборе файла на ЯДиске необходимо указывать полный путь к файлу, если он не расположен в корневом 
каталоге.

В диалоге создания списка файлов доступны три ключевых команды:
- **end** - завершение ввода файлов
- **clear** - очистка списка файлов
- **abort** - отмена команды и возврат в главное меню

#### выбор или создание альбома
После выбора фотографий для публикации пользователю предлагается выбрать альбом, в котором будут опубликованы фотографии.
Для этого на экран выводится список альбомов доступных для публикации. Публикация в системных альбомах приложением не 
предусмотрена, поэтому в списке будут доступны только пользовательские альбомы.

При желании, возможно создание нового альбома при помощи команды "**new**". В этом случае потребуется указать название и
описание нового альбома.

В этом диалоге также работает команда "**abort**" для отмены операции.

### Копирование файлов с жёсткого диска на Яндекс Диск
Команда: **ya upload**  
Параметр 2: _путь к файлу или папке, которые пользователь хочет загрузить на ЯДиск_ 

#### параметр 2

Команду можно указывать как с параметром, так и без.
В параметре 2 можно указывать как абсолютный, так и относительный путь (со стартовой точкой в каталоге, 
где располагается файл main.py(.exe)). Допустимо использование прямого и обратного слэшей. Можно указывать файл или 
папку целиком. Возможно указывать несколько файлов или папок, отделяя их друг от друга запятыми. Для выбора содержимого корневого
каталога целиком (каталога с файлом main.py(.exe)) потребуется указать абсолютный (полный путь).

При неуказании параметра пользователь будет перенаправлен в диалог выбора файлов. Файлы в этом диалоге можно добавлять 
по одному или указывая папку целиком. После каждого ввода список файлов обновится и будет выведен на экран, и поле ввода
будет готово для выбора нового файла или папки. 

Допустимо указывать как абсолютный путь к файлу или папке, так и относительный (со стартовой точкой в каталоге, 
где располагается файл main.py(.exe)). Допускается использование как прямого, так и обратного слэша. Если нажать "ввод" 
без указания каталога, команда будет расценена как указание текущего каталога (каталог c main.py(.exe)). Имена файлов 
необходимо указывать с учетом регистра и с указанием расширения файла. Подкаталоги в список не попападают.

В диалоге создания списка файлов доступны три ключевых команды:
- **end** - завершение ввода файлов
- **clear** - очистка списка файлов
- **abort** - отмена команды и возврат в главное меню

#### выбор целевого каталога

Далее программа предложит пользователю выбрать директорию на Яндекс Диске, куда следует сохранить собраные в список
файлы. Если указанный каталог не существет, он будет создан вместе со всеми подкаталогами в указанном пути.

Файлы сохраняются под теми же именами, что и на жёстком диске. В случае, если файл с таким именем уже существует в 
указанном каталоге, пользователю будет задан вопрос о допустимости перезаписи (выбор при помощи команд "y" или "n").
При отказе от перезаписи файл будет сохранен с дополнением [copy].

### Копирование файлов с Яндекс Диска на компьютер пользователя
Команда: **ya download**  
Параметр 2: _путь к файлу или папке на Яндекс Диске, которые пользователь хочет загрузить на компьютер_ 

#### параметр 2

Команду можно указывать как с параметром, так и без. В параметре необходимо указывать полный путь к файлу или папке, 
если они не расположены в корневом каталоге.
Путь может указываться с префиксом disk:// или без него.
Допустимо использование прямого и обратного слэшей. Можно указывать файл или 
папку целиком. Возможно указывать несколько файлов или папок, отделяя их друг от друга запятыми. 

При неуказании параметра пользователь будет перенаправлен в диалог выбора файлов. Файлы в этом диалоге можно добавлять 
по одному или указывая папку целиком. После каждого ввода список файлов обновится и будет выведен на экран, и поле ввода
будет готово для выбора нового файла или папки. 

Если файл не расположен в корневом каталоге, необходимо указать полный путь к файлу. Допускается использование как 
прямого, так и обратного слэша. Если нажать "ввод" 
без указания каталога, команда будет расценена как указание корневого каталога. Подкаталоги в список не попападают. 
Имена файлов необходимо указывать с учетом регистра и с указанием расширения файла.

В диалоге создания списка файлов доступны три ключевых команды:
- **end** - завершение ввода файлов
- **clear** - очистка списка файлов
- **abort** - отмена команды и возврат в главное меню

#### выбор целевого каталога
Далее программа предложит пользователю выбрать папку, в которую будут сохранены выбранные файлы.

ВАЖНО: Программой не предусмотрены функции создания папок на жёстком диске, поэтому каталог должен уже существовать. 
Также программа не производит проверку существования файла с таким же именем. В случае совпадения произойдёт перезапись. 
Следует быть внимательным и осторожным при использовании этой функции.

# Создание JSON токена

Создание токена осуществляется при первом запуске программы или при запуске модуля **create_TOKEN.py**. При каждом 
запуске приложения, программа проверяет наличие файла в каталоге _data/TOKEN/TOKEN.json_, а также проверку валидности 
каждого токена в отдельности. При отсутствии файла или непринятии хотя бы одного из хранящихся в нём токенов, программа 
инициирует работу модуля create_TOKEN.py для создания/перезаписи ключа.

ВАЖНО: Данные, сохранённые в файле data/TOKEN/TOKEN.json являются строго конфиденциальными. Публикация или передача этих
данных третьим лицам может привести к потере контроля над аккаунтами vk.com и Яндекс Диск. 

#### процедура получения токенов

Процедура получения токенов в деталях описана в самом приложении. Пользователю требуется перейти по ссылкам, 
предложеным в программе. Затем потребуется осуществить вход в свой собственный аккаунт Яндекс Диска и vk.com с помощью 
аутентификационной формы веб-приложения. 

Для Яндекс Диска: токен появится в поле рядом с кнопкой "получить OAuth-токен"

Для vk.com: 
1) В появившемся диалоговом окне потребуется дать разрешения приложению FPY-71 на доступ к запрашиваемым разделам
информации
2) После редиректа полностью скопировать содержимое адресной строки браузера в поле для ввода в приложении, и оно само
вычленит токен из скопированной ссылки

Данные действия не потребуется повторять при повторном запуске программы, при условии что для подключения к интернету 
используется статичный ip адрес.

# Сохранение лога действий

Сохранения лога действий производится автоматически. После каждой загрузки файлов или публикации/сохранения фотографий
подробный отчёт с указанием каталогов, альбомов и названий файлов сохраняется в файл _data/log.json_. Файл создается 
при первом использовании приложения и затем дополняется при каждом последующем использовании.

Файл может путь прочитан любым текстовым редактором. Кодировку следует настроить на Uncicode (UTF-8).
